import{useCallback as V,useEffect as K,useMemo as M,useState as c}from"react";import{DAppKitUI as w}from"@vechain/dapp-kit-ui";import{subscribeKey as x}from"valtio/vanilla/utils";import{createContext as B}from"react";var i=B(void 0);import{jsx as b}from"react/jsx-runtime";var W=({children:e,connex:t})=>{let[o,n]=c(t.wallet.state.address),[r,a]=c(t.wallet.state.accountDomain),[d,C]=c(t.wallet.state.isAccountDomainLoading),[m,g]=c(t.wallet.state.source),[p,y]=c(t.wallet.state.connectionCertificate);K(()=>{let D=x(t.wallet.state,"address",s=>{n(s)}),L=x(t.wallet.state,"accountDomain",s=>{a(s)}),N=x(t.wallet.state,"isAccountDomainLoading",s=>{C(s)}),O=x(t.wallet.state,"source",s=>{g(s)}),T=x(t.wallet.state,"connectionCertificate",s=>{y(s)});return()=>{D(),L(),N(),O(),T()}},[t.wallet.state]);let u=V(()=>{w.modal.open()},[]),f=V(()=>{w.modal.close()},[]),A=V(D=>w.modal.onConnectionStatusChange(D),[]),h=M(()=>({connex:{thor:t.thor,vendor:t.vendor},wallet:{setSource:t.wallet.setSource,disconnect:t.wallet.disconnect,connect:t.wallet.connect,availableWallets:t.wallet.state.availableSources,account:o,accountDomain:r,isAccountDomainLoading:d,source:m,connectionCertificate:p,signTypedData:t.wallet.signTypedData},modal:{open:u,close:f,onConnectionStatusChange:A}}),[t,o,r,d,m,p,u,f,A]);return b(i.Provider,{value:h,children:e})},ot=({children:e,nodeUrl:t,genesis:o,walletConnectOptions:n,usePersistence:r=!1,logLevel:a,requireCertificate:d,themeMode:C,themeVariables:m,i18n:g,language:p,modalParent:y,onSourceClick:u,connectionCertificate:f,allowedWallets:A})=>{let[h,D]=c(null);return K(()=>{D(w.configure({nodeUrl:t,genesis:o,walletConnectOptions:n,usePersistence:r,logLevel:a,requireCertificate:d,themeVariables:m,themeMode:C,i18n:g,language:p,modalParent:y,onSourceClick:u,connectionCertificate:f,allowedWallets:A}))},[t,o,n,r,a,d,m,C,g,p,y,u,f,A]),h?b(W,{connex:h,children:e}):null};import{useContext as I}from"react";var v=()=>{let e=I(i);if(!e)throw new Error('"useConnex" must be used within a ConnexProvider');return e.connex};import{useContext as k}from"react";var mt=()=>{let e=k(i);if(!e)throw new Error('"useWallet" must be used within a ConnexProvider');return e.wallet};import{useContext as U}from"react";var At=()=>{let e=U(i);if(!e)throw new Error('"useWalletModal" must be used within a ConnexProvider');return e.modal};import _ from"react";import{Button as F}from"@vechain/dapp-kit-ui";import{createComponent as z}from"@lit/react";var yt=z({tagName:"vdk-button",elementClass:F,react:_});import{useEffect as Y,useState as P}from"react";import{addressUtils as X}from"@vechain/sdk-core";import{genesisBlocks as G}from"@vechain/dapp-kit";var l={main:"0xA11413086e163e41901bb81fdc5617c975Fa5a1A",test:"0xc403b8EA53F707d7d4de095f0A20bC491Cf2bc94"};var H={inputs:[{internalType:"address[]",name:"addresses",type:"address[]"}],name:"getNames",outputs:[{internalType:"string[]",name:"names",type:"string[]"}],stateMutability:"view",type:"function"},R=async({address:e,connex:t})=>{if(!e)return;let o=t.thor.genesis.id===G.test.id?l.test:l.main,n=await t.thor.account(o).method(H).call([e]),{decoded:{names:r}}=n;return r?.[0]||void 0};import{genesisBlocks as J}from"@vechain/dapp-kit";var Q={inputs:[{internalType:"string[]",name:"names",type:"string[]"}],name:"getAddresses",outputs:[{internalType:"address[]",name:"addresses",type:"address[]"}],stateMutability:"view",type:"function"},S=async({domain:e,connex:t})=>{if(!e)return;let o=t.thor.genesis.id===J.test.id?l.test:l.main,n=await t.thor.account(o).method(Q).call([e]),{decoded:{addresses:r}}=n;return r?.[0]||void 0};var E=async({addressOrDomain:e,connex:t})=>{if(!e)return{address:void 0,domain:void 0,isValidAddressOrDomain:!1};if(X.isAddress(e))try{let n=await R({address:e,connex:t});return{address:e,domain:n,isValidAddressOrDomain:!0}}catch(n){return console.error("Error getting domain: ",n),{address:e,domain:void 0,isValidAddressOrDomain:!0}}try{let n=await S({domain:e,connex:t});return n==="0x0000000000000000000000000000000000000000"?{address:void 0,domain:void 0,isValidAddressOrDomain:!1}:{address:n,domain:e,isValidAddressOrDomain:!0}}catch(n){return console.error("Error getting address: ",n),{address:void 0,domain:void 0,isValidAddressOrDomain:!1}}};var Mt=({addressOrDomain:e})=>{let t=v(),[o,n]=P({address:void 0,domain:void 0,isValidAddressOrDomain:!1}),[r,a]=P(!1);return Y(()=>{a(!0),E({addressOrDomain:e,connex:t}).then(n).catch(d=>{console.error("Error fetching vechain domain: ",d),n({address:void 0,domain:void 0,isValidAddressOrDomain:!1})}).finally(()=>a(!1))},[e,t]),{...o,isLoading:r}};export{ot as DAppKitProvider,W as DAppKitProviderData,yt as WalletButton,v as useConnex,Mt as useVechainDomain,mt as useWallet,At as useWalletModal};
//# sourceMappingURL=index.js.map