{"version":3,"sources":["../../src/services/contracts.service.ts"],"sourcesContent":["import { HttpException } from '@/exceptions/HttpException';\nimport { Submission } from '@/interfaces/submission.interface';\nimport { servareContract } from '@/utils/thor';\nimport { Service } from 'typedi';\nimport * as console from 'node:console';\nimport { unitsUtils } from '@vechain/sdk-core';\nimport { REWARD_AMOUNT } from '@config';\n@Service()\nexport class ContractsService {\n  public async registerSubmission(submission: Submission): Promise<boolean> {\n    let isSuccess = false;\n    try {\n      const result = await (\n        await servareContract.transact.registerValidSubmission(submission.address, unitsUtils.parseUnits(REWARD_AMOUNT, 'ether'))\n      ).wait();\n      isSuccess = !result.reverted;\n    } catch (error) {\n      console.log('Error', error);\n    }\n\n    return isSuccess;\n  }\n\n  public async validateSubmission(submission: Submission): Promise<void> {\n    const isMaxSubmissionsReached = (await servareContract.read.isUserMaxSubmissionsReached(submission.address))[0];\n    if (Boolean(isMaxSubmissionsReached) === true) throw new HttpException(409, `EcoEarn: Max submissions reached for this cycle`);\n  }\n}\n"],"names":["ContractsService","registerSubmission","submission","isSuccess","result","servareContract","transact","registerValidSubmission","address","unitsUtils","parseUnits","REWARD_AMOUNT","wait","reverted","error","console","log","validateSubmission","isMaxSubmissionsReached","read","isUserMaxSubmissionsReached","Boolean","HttpException","Service"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAQaA;;;eAAAA;;;+BARiB;sBAEE;wBACR;uDACC;yBACE;wBACG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEvB,IAAA,AAAMA,mBAAN,MAAMA;IACX,MAAaC,mBAAmBC,UAAsB,EAAoB;QACxE,IAAIC,YAAY;QAChB,IAAI;YACF,MAAMC,SAAS,MAAM,AACnB,CAAA,MAAMC,qBAAe,CAACC,QAAQ,CAACC,uBAAuB,CAACL,WAAWM,OAAO,EAAEC,mBAAU,CAACC,UAAU,CAACC,qBAAa,EAAE,SAAQ,EACxHC,IAAI;YACNT,YAAY,CAACC,OAAOS,QAAQ;QAC9B,EAAE,OAAOC,OAAO;YACdC,aAAQC,GAAG,CAAC,SAASF;QACvB;QAEA,OAAOX;IACT;IAEA,MAAac,mBAAmBf,UAAsB,EAAiB;QACrE,MAAMgB,0BAA0B,AAAC,CAAA,MAAMb,qBAAe,CAACc,IAAI,CAACC,2BAA2B,CAAClB,WAAWM,OAAO,CAAA,CAAE,CAAC,EAAE;QAC/G,IAAIa,QAAQH,6BAA6B,MAAM,MAAM,IAAII,4BAAa,CAAC,KAAK,CAAC,+CAA+C,CAAC;IAC/H;AACF;AAnBatB;IADZuB,IAAAA,eAAO;GACKvB"}